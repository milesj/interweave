(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{71:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return l})),t.d(n,"metadata",(function(){return o})),t.d(n,"rightToc",(function(){return b})),t.d(n,"default",(function(){return c}));var a=t(2),r=t(6),i=(t(0),t(75)),l={title:"HTML parsing"},o={unversionedId:"parser",id:"parser",isDocsHomePage:!1,title:"HTML parsing",description:"Interweave doesn't rely on an HTML parser for rendering HTML safely; instead, it uses the DOM",source:"@site/docs/parser.md",permalink:"/docs/parser",editUrl:"https://github.com/milesj/interweave/edit/master/website/docs/parser.md",sidebar:"docs",previous:{title:"Composition",permalink:"/docs/compose"},next:{title:"Server-side rendering",permalink:"/docs/ssr"}},b=[{value:"Allowed tags",id:"allowed-tags",children:[]},{value:"Allowed attributes",id:"allowed-attributes",children:[]},{value:"Render precedence",id:"render-precedence",children:[]},{value:"By-passing allowed",id:"by-passing-allowed",children:[]},{value:"Replacing elements",id:"replacing-elements",children:[]},{value:"Disabling HTML",id:"disabling-html",children:[]}],p={rightToc:b};function c(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},p,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("p",null,"Interweave doesn't rely on an HTML parser for rendering HTML safely; instead, it uses the DOM\nitself. It accomplishes this by using ",Object(i.b)("inlineCode",{parentName:"p"},"DOMImplementation.createHTMLDocument")," (",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createHTMLDocument"}),"MDN"),"), which\ncreates an HTML document in memory, allowing us to easily set markup, aggregate nodes, and generate\nReact elements. This implementation is supported by all modern browsers and IE9+."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"DOMImplementation")," has the added benefit of not requesting resources (images, scripts, etc) until\nthe document has been rendered to the page. This provides an extra layer of security by avoiding\npossible CSRF and arbitrary code execution."),Object(i.b)("p",null,"Furthermore, Interweave manages a list of both HTML tags and attributes, further increasing\nsecurity, and reducing the risk of XSS and vulnerabilities."),Object(i.b)("h2",{id:"allowed-tags"},"Allowed tags"),Object(i.b)("p",null,"Interweave keeps a mapping of renderable ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/milesj/interweave/blob/master/packages/core/src/constants.ts#L15"}),"HTML tags to parsing configurations"),". These\nconfigurations handle the following rules and processes."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Defines the type of rule: allow or deny."),Object(i.b)("li",{parentName:"ul"},"Defines the type of tag: inline, block, inline-block."),Object(i.b)("li",{parentName:"ul"},"Flags whether inline children can be rendered."),Object(i.b)("li",{parentName:"ul"},"Flags whether block children can be rendered."),Object(i.b)("li",{parentName:"ul"},"Flags whether children of the same tag name can be rendered."),Object(i.b)("li",{parentName:"ul"},"Maps the parent tags the current element can render in."),Object(i.b)("li",{parentName:"ul"},"Maps the child tags the current element can render.")),Object(i.b)("p",null,"The following tags are not supported, but their children will still be rendered."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"acronym"),", ",Object(i.b)("inlineCode",{parentName:"p"},"area"),", ",Object(i.b)("inlineCode",{parentName:"p"},"basefont"),", ",Object(i.b)("inlineCode",{parentName:"p"},"bgsound"),", ",Object(i.b)("inlineCode",{parentName:"p"},"big"),", ",Object(i.b)("inlineCode",{parentName:"p"},"blink"),", ",Object(i.b)("inlineCode",{parentName:"p"},"center"),", ",Object(i.b)("inlineCode",{parentName:"p"},"col"),", ",Object(i.b)("inlineCode",{parentName:"p"},"content"),", ",Object(i.b)("inlineCode",{parentName:"p"},"data"),",\n",Object(i.b)("inlineCode",{parentName:"p"},"datalist"),", ",Object(i.b)("inlineCode",{parentName:"p"},"dialog"),", ",Object(i.b)("inlineCode",{parentName:"p"},"dir"),", ",Object(i.b)("inlineCode",{parentName:"p"},"font"),", ",Object(i.b)("inlineCode",{parentName:"p"},"form"),", ",Object(i.b)("inlineCode",{parentName:"p"},"hgroup"),", ",Object(i.b)("inlineCode",{parentName:"p"},"image"),", ",Object(i.b)("inlineCode",{parentName:"p"},"input"),", ",Object(i.b)("inlineCode",{parentName:"p"},"isindex"),", ",Object(i.b)("inlineCode",{parentName:"p"},"keygen"),",\n",Object(i.b)("inlineCode",{parentName:"p"},"listing"),", ",Object(i.b)("inlineCode",{parentName:"p"},"marquee"),", ",Object(i.b)("inlineCode",{parentName:"p"},"menu"),", ",Object(i.b)("inlineCode",{parentName:"p"},"menuitem"),", ",Object(i.b)("inlineCode",{parentName:"p"},"meter"),", ",Object(i.b)("inlineCode",{parentName:"p"},"multicol"),", ",Object(i.b)("inlineCode",{parentName:"p"},"nobr"),", ",Object(i.b)("inlineCode",{parentName:"p"},"noembed"),", ",Object(i.b)("inlineCode",{parentName:"p"},"noframes"),",\n",Object(i.b)("inlineCode",{parentName:"p"},"optgroup"),", ",Object(i.b)("inlineCode",{parentName:"p"},"option"),", ",Object(i.b)("inlineCode",{parentName:"p"},"param"),", ",Object(i.b)("inlineCode",{parentName:"p"},"plaintext"),", ",Object(i.b)("inlineCode",{parentName:"p"},"progress"),", ",Object(i.b)("inlineCode",{parentName:"p"},"select"),", ",Object(i.b)("inlineCode",{parentName:"p"},"shadow"),", ",Object(i.b)("inlineCode",{parentName:"p"},"slot"),", ",Object(i.b)("inlineCode",{parentName:"p"},"spacer"),",\n",Object(i.b)("inlineCode",{parentName:"p"},"strike"),", ",Object(i.b)("inlineCode",{parentName:"p"},"template"),", ",Object(i.b)("inlineCode",{parentName:"p"},"textarea"),", ",Object(i.b)("inlineCode",{parentName:"p"},"tt"),", ",Object(i.b)("inlineCode",{parentName:"p"},"wbr"),", ",Object(i.b)("inlineCode",{parentName:"p"},"xmp")),Object(i.b)("p",null,"The following tags and their children will never be rendered, even when the allow list is disabled."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"applet"),", ",Object(i.b)("inlineCode",{parentName:"p"},"base"),", ",Object(i.b)("inlineCode",{parentName:"p"},"body"),", ",Object(i.b)("inlineCode",{parentName:"p"},"canvas"),", ",Object(i.b)("inlineCode",{parentName:"p"},"command"),", ",Object(i.b)("inlineCode",{parentName:"p"},"embed"),", ",Object(i.b)("inlineCode",{parentName:"p"},"frame"),", ",Object(i.b)("inlineCode",{parentName:"p"},"frameset"),", ",Object(i.b)("inlineCode",{parentName:"p"},"head"),", ",Object(i.b)("inlineCode",{parentName:"p"},"html"),", ",Object(i.b)("inlineCode",{parentName:"p"},"link"),",\n",Object(i.b)("inlineCode",{parentName:"p"},"meta"),", ",Object(i.b)("inlineCode",{parentName:"p"},"noscript"),", ",Object(i.b)("inlineCode",{parentName:"p"},"object"),", ",Object(i.b)("inlineCode",{parentName:"p"},"script"),", ",Object(i.b)("inlineCode",{parentName:"p"},"style"),", ",Object(i.b)("inlineCode",{parentName:"p"},"title")),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"The list of allowed tags can be customized using the ",Object(i.b)("inlineCode",{parentName:"p"},"allowList")," prop, which accepts a list of\nHTML tag names.")),Object(i.b)("h2",{id:"allowed-attributes"},"Allowed attributes"),Object(i.b)("p",null,"Interweave takes parsing a step further, by also ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"./filters.md"}),"filtering")," attribute values and HTML\nnodes. Like tags, a mapping of renderable ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/milesj/interweave/blob/master/packages/core/src/constants.ts#L306"}),"HTML attributes to parser rules")," exist. A rule\ncan be one of: allow and cast to string (default), allow and cast to number, allow and cast to\nboolean, and finally, deny."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Any attribute not found in the mapping will be ignored unless ",Object(i.b)("inlineCode",{parentName:"p"},"allowAttributes")," is passed.")),Object(i.b)("h2",{id:"render-precedence"},"Render precedence"),Object(i.b)("p",null,"There are 3 levels of rendering, in order:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"Banned")," - Tags that will ",Object(i.b)("em",{parentName:"li"},"never")," be rendered, regardless of the allow list, or what the\nconsumer configures. This is based on the ",Object(i.b)("inlineCode",{parentName:"li"},"BANNED_TAG_LIST")," constant. This takes the highest\nprecedence."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"Blocked")," - Tags that will ",Object(i.b)("em",{parentName:"li"},"not")," be rendered and are configured through the consumer with the\n",Object(i.b)("inlineCode",{parentName:"li"},"blockList")," prop. This takes precedence over ",Object(i.b)("inlineCode",{parentName:"li"},"allowList")," and ",Object(i.b)("inlineCode",{parentName:"li"},"allowElements"),"."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"Allowed")," - Tags that will be rendered. The default allow list is based on the\n",Object(i.b)("inlineCode",{parentName:"li"},"ALLOWED_TAG_LIST")," constant, or can be configured by the consumer with the ",Object(i.b)("inlineCode",{parentName:"li"},"allowList")," prop. The\n",Object(i.b)("inlineCode",{parentName:"li"},"allowElements")," prop has a higher precedence than ",Object(i.b)("inlineCode",{parentName:"li"},"allowList"),", but both of which are lower than\nblocked or banned tags.")),Object(i.b)("h2",{id:"by-passing-allowed"},"By-passing allowed"),Object(i.b)("p",null,"If need be, the allowed tag list can be disabled with the ",Object(i.b)("inlineCode",{parentName:"p"},"allowElements")," prop, which renders all\nHTML elements except for banned tags (hard-coded) and blocked tags (provided by ",Object(i.b)("inlineCode",{parentName:"p"},"blockList"),").\nFurthermore, the allowed attribute list can be disabled with ",Object(i.b)("inlineCode",{parentName:"p"},"allowAttributes"),", which renders all\nnon-event and non-XSS attack vector attributes."),Object(i.b)("p",null,"These props are highly discouraged as it opens up possible XSS and injection attacks, and should\nonly be used if the markup passed to ",Object(i.b)("inlineCode",{parentName:"p"},"Interweave")," has been sanitized beforehand."),Object(i.b)("p",null,"That being said, banned tags like ",Object(i.b)("inlineCode",{parentName:"p"},"script"),", ",Object(i.b)("inlineCode",{parentName:"p"},"applet"),", and a few others are consistently removed."),Object(i.b)("h2",{id:"replacing-elements"},"Replacing elements"),Object(i.b)("p",null,"By default, Interweave converts tags to an ",Object(i.b)("inlineCode",{parentName:"p"},"<Element />")," React component, which renders the\nappropriate DOM node. For custom block-level elements, the ",Object(i.b)("inlineCode",{parentName:"p"},"transform")," function prop can be passed."),Object(i.b)("p",null,"This function receives the parsed DOM node, and can return either a React element (which is inserted\ninto the React element tree), undefined to use the default ",Object(i.b)("inlineCode",{parentName:"p"},"<Element />")," component, or null to skip\nthe element entirely."),Object(i.b)("p",null,"For example, to replace ",Object(i.b)("inlineCode",{parentName:"p"},"a")," elements with a custom element:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx"}),"import Interweave, { Node } from 'interweave';\n\nfunction transform(node: HTMLElement, children: Node[]): React.ReactNode {\n  if (node.tagName === 'a') {\n    return <Link href={node.getAttribute('href')}>{children}</Link>;\n  }\n}\n\n<Interweave transform={transform} />;\n")),Object(i.b)("p",null,"Note that ",Object(i.b)("inlineCode",{parentName:"p"},"transform")," is run before checking the allowed list, permitting you to use non-allowed\ntags in a controlled way. Banned tags like ",Object(i.b)("inlineCode",{parentName:"p"},"script")," will not be transformed."),Object(i.b)("h2",{id:"disabling-html"},"Disabling HTML"),Object(i.b)("p",null,"The HTML parser cannot be disabled, however, a ",Object(i.b)("inlineCode",{parentName:"p"},"noHtml")," boolean prop can be passed to both the\n",Object(i.b)("inlineCode",{parentName:"p"},"<Interweave />")," and ",Object(i.b)("inlineCode",{parentName:"p"},"<Markup />")," components. This prop will mark all HTML elements as pass-through,\nsimply rendering text nodes recursively, including matchers."),Object(i.b)("p",null,"If you want to strip user provided HTML, but allow HTML from matchers, use the\n",Object(i.b)("inlineCode",{parentName:"p"},"noHtmlExceptMatchers")," prop instead."))}c.isMDXComponent=!0},75:function(e,n,t){"use strict";t.d(n,"a",(function(){return s})),t.d(n,"b",(function(){return u}));var a=t(0),r=t.n(a);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function b(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=r.a.createContext({}),c=function(e){var n=r.a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},s=function(e){var n=c(e.components);return r.a.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},m=r.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,p=b(e,["components","mdxType","originalType","parentName"]),s=c(t),m=a,u=s["".concat(l,".").concat(m)]||s[m]||d[m]||i;return t?r.a.createElement(u,o(o({ref:n},p),{},{components:t})):r.a.createElement(u,o({ref:n},p))}));function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,l=new Array(i);l[0]=m;var o={};for(var b in n)hasOwnProperty.call(n,b)&&(o[b]=n[b]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var p=2;p<i;p++)l[p]=t[p];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);